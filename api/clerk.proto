syntax = "proto3";

package scribe.v1;

option go_package = "../pb";

message Event {
    bytes id = 1;
    repeated Attribute attributes = 2;
}

message Attribute {
    string key = 1;
    oneof value {
        string as_string = 2;
        int64 as_int64 = 3;
        double as_double = 4;
        bool as_bool = 5;
    }
}

message Index {
    message Chunk {
        message Mark {
            int64 size = 1;
            int64 offset = 2;
        }
        repeated bytes ids = 1;
        Mark mark = 2;
    }

    repeated Chunk chunks = 1;
}

message Filters {
    message TimeMillis {
        int64 start = 1;
        int64 end = 2;
    }
    bytes bloom = 1;
    TimeMillis time_millis = 2;
}


message CreateEventsRequest {
    repeated Event events = 1;
}

message CreateEventsResponse {}

message SearchRequest {
    bytes id = 1;
}

message SearchResponse {
    Event event = 1;
}

message AppendBlockRequest {
    string name = 1;
}

message AppendBlockResponse {
    
}

service Recorder {
    rpc CreateEvents(CreateEventsRequest) returns (CreateEventsResponse) {}
    rpc Search(SearchRequest) returns (SearchResponse) {}
}

service Searcher {
    rpc AppendBlock(AppendBlockRequest) returns (AppendBlockResponse) {}
    rpc Search(SearchRequest) returns (SearchResponse) {}
}